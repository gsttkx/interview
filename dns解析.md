# 在浏览器上输入网址到你看到页面都经历了什么？

## 1.主干流程
```
1.浏览器接收URL并开启一个新进程（这一部分可以展开浏览器的进程与线程的关系）

2.浏览器解析输入的URL，提取出其中的协议、域名和路径等信息。（这部分涉及URL组成部分）

3.浏览器向DNS服务器发送请求，DNS服务器通过 多层查询 将该 域名 解析为对应的IP地址 ，然后将请求发送到该IP地址上，与服务器建
立连接和交换数据。（这部分涉及DNS解析）

4.浏览器与服务器建立TCP连接。（这部分涉及TCP三次握手/四次挥手/5层网络协议）

5.浏览器向服务器发送HTTP请求，包含请求头和请求体。（4,5,6,7包含http头部、响应码、报文结构、cookie等知识）

6.服务器接收并处理请求，并返回响应数据，包含状态码、响应头和响应体。

7.浏览器接收到响应数据，解析响应头和响应体，并根据状态码判断是否成功。

8.如果响应成功，浏览器接收到http数据包后的解析流程（这部分涉及到html - 词法分析，解析成DOM树，解析CSS生成CSSOM树（样式树），
合并生成render渲染树（样式计算）。然后layout布局，分层，调用GPU绘制等，最后将绘制的结果合成最终的页面图像，显示在屏幕上。
这个过程会发生回流和重绘）。

9.连接结束 -> 断开TCP连接（这部分涉及四次挥手）
```

## 2.DNS域名解析

浏览器缓存 -> 本地DNS服务器 -> 根域名服务器(返回顶级域名所在服务器) -> 顶级域名服务器（返回权威域名服务器）-> 权威域名服务器（返回ip给本地DNS服务器，并缓存）-> 浏览器缓存

## 3.TCP三次握手

|       | TCP |  UDP | 
| ----------- | ----------- | ----------- |
| 区别   | 面向连接、可靠、提供流量控制、仅支持一对一通信       | 非面向连接、不可靠、不提供流量控制、支持多对多通信 |
| 优势   | 传输数据安全可靠        | 传输速度快、占用资源少|

**TCP的三次握手**

* 第一次握手：客户端向服务端请求建立连接
  * SYN=1（建立连接）
  * SEQ=x（序列号）
    
  客户端进入SYN_SENT状态。

* 第二次握手：服务端向客户端返回确认并请求建立连接
  * SYN=1（建立连接）
  * ACK=1 （已收到）
  * ack=x+1（确认号为收到的序列号加一）
  * seq=y（序列号）
      
  服务端进入SYN_RCVD状态。

* 第三次握手：客户端向服务端发送确认报文
  * ACK=1 （已收到）
  * ack=y+1（确认号为收到的序列号加一）
  * seq=x+1（序列号）

三次握手完成以后，2个主机之间，就可以传输数据啦~
  
![image](https://github.com/gsttkx/interview/assets/158159581/9d5b0dd6-15ac-4967-b7f9-a2111dc78864)


**TCP的四次握手**

当数据传输完成后，两台主机需要通过四次会话断开连接，这个过程我们称为四次挥手。

* 第一次挥手：客户端向服务端请求断开连接 （客户端 -> 服务端）
  * FIN=1（断开连接）
  * seq=u（序列号）

  客户端进入FIN_WAIT_1状态

* 第二次挥手：服务端向客户端返回确认报文 （服务端 -> 客户端）
  * ACK=1 （已收到）
  * ack=u+1（确认号为收到的序列号加一）
  * seq=v（序列号）
 
  服务端进入CLOSE_WAIT状态，客户端进入FIN_WAIT_2状态。
  
* 第三次挥手：服务端完成数据传输后，向客户端发送断开连接请求 （服务端 -> 客户端）
  * FIN=1（断开连接）
  * ACK=1 （已收到）
  * ack=u+1（确认号为收到的序列号加一）
  * seq=w（序列号）
 
  服务端进入LAST_ACK状态

* 第四次挥手：客户端向服务端返回确认报文 （客户端 -> 服务端）
  * ACK=1 （已收到）
  * ack=w+1（确认号为收到的序列号加一）
  * seq=u+1（序列号）
 
  客户端进入TIME_WAIT状态，服务端进入CLOSED状态。客户端处于TIME_WAIT状态时，TCP连接还未释放掉，等待2个MSL（Maximum Segment Lifetime，最大段生命周期）的时长后，客户端进入CLOSE状态。

  ![image](https://github.com/gsttkx/interview/assets/158159581/fdf99b36-080a-4a2e-9226-013461d177e3)













